<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Complete tutorial on how to use Hydra in Machine Learning projects | Kushajveer Singh</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Complete tutorial on how to use Hydra in Machine Learning projects" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Learn everything you need to know on how to use Hydra in your machine learning projects. All features of Hydra are discussed with a dummy ML example." />
<meta property="og:description" content="Learn everything you need to know on how to use Hydra in your machine learning projects. All features of Hydra are discussed with a dummy ML example." />
<link rel="canonical" href="https://kushajveersingh.github.io/blog/complete-tutorial-on-how-to-use-hydra-in-machine-learning-projects" />
<meta property="og:url" content="https://kushajveersingh.github.io/blog/complete-tutorial-on-how-to-use-hydra-in-machine-learning-projects" />
<meta property="og:site_name" content="Kushajveer Singh" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-03-16T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://kushajveersingh.github.io/blog/complete-tutorial-on-how-to-use-hydra-in-machine-learning-projects","headline":"Complete tutorial on how to use Hydra in Machine Learning projects","dateModified":"2021-03-16T00:00:00-05:00","datePublished":"2021-03-16T00:00:00-05:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://kushajveersingh.github.io/blog/complete-tutorial-on-how-to-use-hydra-in-machine-learning-projects"},"description":"Learn everything you need to know on how to use Hydra in your machine learning projects. All features of Hydra are discussed with a dummy ML example.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://kushajveersingh.github.io/blog/feed.xml" title="Kushajveer Singh" /><!-- the google_analytics_id gets auto inserted from the config file -->



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-123402359-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123402359-3');
</script>


<link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Kushajveer Singh</a></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Complete tutorial on how to use Hydra in Machine Learning projects</h1><p class="page-description">Learn everything you need to know on how to use Hydra in your machine learning projects. All features of Hydra are discussed with a dummy ML example.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-03-16T00:00:00-05:00" itemprop="datePublished">
        Mar 16, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      17 min read
    
</span></p>

    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#understanding-hydra-setup-process">Understanding Hydra setup process</a>
<ul>
<li class="toc-entry toc-h3"><a href="#how-hydra-handles-different-runs">How hydra handles different runs</a></li>
<li class="toc-entry toc-h3"><a href="#contents-of-each-subfolder">Contents of each subfolder</a></li>
<li class="toc-entry toc-h3"><a href="#how-to-use-logging">How to use logging</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#quick-omegaconf-overview">Quick OmegaConf overview</a></li>
<li class="toc-entry toc-h2"><a href="#using-hydra-for-ml-projects">Using Hydra for ML projects</a>
<ul>
<li class="toc-entry toc-h3"><a href="#dataset">Dataset</a></li>
<li class="toc-entry toc-h3"><a href="#model">Model</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#random-things">Random things</a>
<ul>
<li class="toc-entry toc-h3"><a href="#show-config-file">Show config file</a></li>
<li class="toc-entry toc-h3"><a href="#multi-run">Multi-run</a></li>
<li class="toc-entry toc-h3"><a href="#add-color-to-terminal">Add color to terminal</a></li>
<li class="toc-entry toc-h3"><a href="#specify-help-message">Specify help message</a></li>
<li class="toc-entry toc-h3"><a href="#output-directory-name">Output directory name</a></li>
</ul>
</li>
</ul><p><a href="https://hydra.cc/">hydra website</a></p>

<p>In an effort to increase standardization across the PyTorch ecosystem Facebook AI in a recent <a href="https://ai.facebook.com/blog/reengineering-facebook-ais-deep-learning-platforms-for-interoperability/">blog post</a> told that they would be leveraging Facebook’s open source <a href="https://hydra.cc/">Hydra framework</a> to handle configs, and also offer an integration with <a href="https://www.pytorchlightning.ai/">PyTorch Lightning</a>. This post is about Hydra.</p>

<p>If you are reading this post then I assume you are familiar with what are config files, why are they useful and how they increase reproducibility. And you also know what nightmare is <a href="https://docs.python.org/3/library/argparse.html">argparse</a>. In general, with config files you can pass all the hyperparameters to your model, you can define all the global constants, define dataset splits and … without touching the core code of your project.</p>

<p>On <a href="https://hydra.cc/docs/intro">Hydra website</a> the following are listed as the key features of Hydra</p>
<ul>
  <li>Hierarchical configuration composable from multiple sources</li>
  <li>Configuration can be specified or overridden from the command line</li>
  <li>Dynamic command line tab completion</li>
  <li>Run your application locally or launch it to run remotely</li>
  <li>Run multiple jobs with different arguments with a single command</li>
</ul>

<p>For the rest of the post, I will introduce Hydra features one-by-one with an example of use case. So follow along, it would be a fun ride.</p>

<h2 id="understanding-hydra-setup-process">
<a class="anchor" href="#understanding-hydra-setup-process" aria-hidden="true"><span class="octicon octicon-link"></span></a>Understanding Hydra setup process</h2>
<p>Install Hydra (I am using version <code class="language-plaintext highlighter-rouge">1.0</code>)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install hydra-core --upgrade
</code></pre></div></div>

<p>For this blog post I would assume the following directory structure, where all the configs are stored in a <code class="language-plaintext highlighter-rouge">config</code> folder, with the main config file being named <code class="language-plaintext highlighter-rouge">config.yaml</code>. And for simplicity assume <code class="language-plaintext highlighter-rouge">main.py</code> is all the source code of our project.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src
├── config
│   └── config.yaml
└── main.py
</code></pre></div></div>

<p>Let’s start with a simple example that will show you the main syntax of using Hydra,</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### config/config.yaml</span>

<span class="na">batch_size</span><span class="pi">:</span> <span class="m">10</span>
<span class="na">lr</span><span class="pi">:</span> <span class="s">1e-4</span>
</code></pre></div></div>

<p>And the corresponding <code class="language-plaintext highlighter-rouge">main.py</code> file</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### main.py
</span>
<span class="kn">import</span> <span class="nn">hydra</span>
<span class="kn">from</span> <span class="nn">omegaconf</span> <span class="kn">import</span> <span class="n">DictConfig</span>

<span class="o">@</span><span class="n">hydra</span><span class="p">.</span><span class="n">main</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="s">"config"</span><span class="p">,</span> <span class="n">config_name</span><span class="o">=</span><span class="s">"config"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
    <span class="n">working_dir</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">f"The current working directory is </span><span class="si">{</span><span class="n">working_dir</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

    <span class="c1"># To access elements of the config
</span>    <span class="k">print</span><span class="p">(</span><span class="s">f"The batch size is </span><span class="si">{</span><span class="n">cfg</span><span class="p">.</span><span class="n">batch_size</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">f"The learning rate is </span><span class="si">{</span><span class="n">cfg</span><span class="p">[</span><span class="s">'lr'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">func</span><span class="p">()</span>
</code></pre></div></div>

<p>Running the script would give the following output</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; python main.py    
The current working directory is src/outputs/2021-03-13/16-22-21

The batch size is 10
The learning rate is 0.0001
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: The path is shortened to not include the complete path from root. Also, you can pass either <code class="language-plaintext highlighter-rouge">config.yaml</code> or <code class="language-plaintext highlighter-rouge">config</code> to <code class="language-plaintext highlighter-rouge">config_name</code>.</p>
</blockquote>

<p>A lot happened, let’s parse it one by one.</p>
<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">omegaconf</code> is installed by default with <code class="language-plaintext highlighter-rouge">hydra</code>. It is only used to provide the type annotation for <code class="language-plaintext highlighter-rouge">cfg</code> argument in <code class="language-plaintext highlighter-rouge">func</code>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">@hydra.main(config_path="config", config_name="config")</code> This is the main decorator function that is used when any function requires contents from a configuration file.</p>
  </li>
  <li>
    <p><strong>Current working directory is changed</strong>. <code class="language-plaintext highlighter-rouge">main.py</code> exists in <code class="language-plaintext highlighter-rouge">src/main.py</code> but the output shows the current working directory is <code class="language-plaintext highlighter-rouge">src/outputs/2021-03-13/16-22-21</code>. This is the most important point when using Hydra. An explanation follows below.</p>
  </li>
</ul>

<h3 id="how-hydra-handles-different-runs">
<a class="anchor" href="#how-hydra-handles-different-runs" aria-hidden="true"><span class="octicon octicon-link"></span></a>How hydra handles different runs</h3>
<p>Whenever a program is executed using <code class="language-plaintext highlighter-rouge">python main.py</code> Hydra will create a new folder in <code class="language-plaintext highlighter-rouge">outputs</code> directory with the following naming scheme <code class="language-plaintext highlighter-rouge">outputs/YYYY-mm-dd/HH-MM-SS</code> i.e. the data and time at which the file was executed. Think about this for a second. Hydra provides you a way to maintain a log of every run without you having to worry about it.</p>

<p>The directory structure after executing <code class="language-plaintext highlighter-rouge">python main.py</code> is (Let’s not worry about the contents of each folder for now)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src
├── config
│   └── config.yaml
├── main.py
├── outputs
│   └── 2021-03-13
│       └── 17-14-24
│           ├── .hydra
│           │   ├── config.yaml
│           │   ├── hydra.yaml
│           │   └── overrides.yaml
│           ├── main.log
</code></pre></div></div>

<p>What happens actually? When you run <code class="language-plaintext highlighter-rouge">src/main.py</code>, hydra moves this file to <code class="language-plaintext highlighter-rouge">src/outputs/2021-03-13/16-22-21/main.py</code> and then runs it. You can verify this by checking the output of <code class="language-plaintext highlighter-rouge">os.getcwd()</code> as shown in the above example. This means if your <code class="language-plaintext highlighter-rouge">main.py</code> relied on some external file, say <code class="language-plaintext highlighter-rouge">test.txt</code>, then you would have to use <code class="language-plaintext highlighter-rouge">../../../test.txt</code> instead, as you are no longer running the program in <code class="language-plaintext highlighter-rouge">src</code> directory. This also means that everything you save to disk would be saved relative to <code class="language-plaintext highlighter-rouge">src/outputs/2021-03-13/16-22-21/</code>.</p>

<p>Hydra provides two utility functions to handle this situation</p>
<ul>
  <li>
    <p><strong>hydra.utils.get_original_cwd()</strong>: Get the original current working directory i.e. <code class="language-plaintext highlighter-rouge">src</code>.</p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="n">orig_cwd</span> <span class="o">=</span> <span class="n">hydra</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">get_original_cwd</span><span class="p">()</span>
  <span class="n">path</span> <span class="o">=</span> <span class="s">f"</span><span class="si">{</span><span class="n">orig_cwd</span><span class="si">}</span><span class="s">/test.txt"</span>

  <span class="c1"># path = src/test.txt
</span></code></pre></div>    </div>
  </li>
  <li>
    <p><strong>hydra.utils.to_absolute_path(file_name)</strong>:</p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="n">path</span> <span class="o">=</span> <span class="n">hydra</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">to_absolute_path</span><span class="p">(</span><span class="s">'test.txt'</span><span class="p">)</span>

  <span class="c1"># path = src/test.txt
</span></code></pre></div>    </div>
  </li>
</ul>

<p>Let’s recap this using a short example. Suppose we want to read <code class="language-plaintext highlighter-rouge">src/test.txt</code> and write the output to <code class="language-plaintext highlighter-rouge">output.txt</code>. The corresponding function to do this would be as shown below</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">hydra</span><span class="p">.</span><span class="n">main</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="s">"config"</span><span class="p">,</span> <span class="n">config_name</span><span class="o">=</span><span class="s">"config"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
    <span class="n">orig_cwd</span> <span class="o">=</span> <span class="n">hydra</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">get_original_cwd</span><span class="p">()</span>

    <span class="c1"># Read file
</span>    <span class="n">path</span> <span class="o">=</span> <span class="s">f"</span><span class="si">{</span><span class="n">orig_cwd</span><span class="si">}</span><span class="s">/test.txt"</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">())</span>

    <span class="c1"># Write file
</span>    <span class="n">path</span> <span class="o">=</span> <span class="s">f"output.txt"</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"This is a dog"</span><span class="p">)</span>
</code></pre></div></div>

<p>We can check the directory structure again, after running <code class="language-plaintext highlighter-rouge">python main.py</code>.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src
├── config
│   └── config.yaml
├── main.py
├── outputs
│   └── 2021-03-13
│       └── 17-14-24
│           ├── .hydra
│           │   ├── config.yaml
│           │   ├── hydra.yaml
│           │   └── overrides.yaml
│           ├── main.log
│           └── output.txt
└── test.txt
</code></pre></div></div>

<p>The file was written to the folder created by hydra. This is a good way to save intermediate results when you are developing something. You can use this feature to save the accuracy results of your model with different hyperparameters. Now you do not have to spend time on manually saving the configuration file or the command line arguments you used to run the script and creating a new folder for each run to store the outputs.</p>

<blockquote>
  <p><strong>Note</strong>: Each <code class="language-plaintext highlighter-rouge">python main.py</code> is run in a new folder. To keep the above output short I removed all the subfolders of previous runs.</p>
</blockquote>

<p>The main point is use <code class="language-plaintext highlighter-rouge">orig_cwd = hydra.utils.get_original_cwd()</code> to get the original working directory path and then you do not have to worry about hydra running your code in different folder.</p>

<h3 id="contents-of-each-subfolder">
<a class="anchor" href="#contents-of-each-subfolder" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contents of each subfolder</h3>
<p>Each subfolder has the following substructure</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src/outputs/2021-03-13/17-14-24/
├── .hydra
│   ├── config.yaml
│   ├── hydra.yaml
│   └── overrides.yaml
└── main.log
</code></pre></div></div>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">config.yaml</code> - Copy of the config file passed to the function (It dosen’t matter if you pass <code class="language-plaintext highlighter-rouge">foo.yaml</code>, this file would still be named <code class="language-plaintext highlighter-rouge">config.yaml</code>)</li>
  <li>
<code class="language-plaintext highlighter-rouge">hydra.yaml</code> - Copy of the hydra config file. We will later see how to change some of the defaults used by hydra. (You can specify the message of <code class="language-plaintext highlighter-rouge">python main.py --help</code> here)</li>
  <li>
<code class="language-plaintext highlighter-rouge">overrides.yaml</code> - Copy of any argument that you provide through command line and which changes one of the default value would be stored here</li>
  <li>
<code class="language-plaintext highlighter-rouge">main.log</code> - Output of logger would be stored here. (For <code class="language-plaintext highlighter-rouge">foo.py</code> this file would be named <code class="language-plaintext highlighter-rouge">foo.log</code>)</li>
</ul>

<h3 id="how-to-use-logging">
<a class="anchor" href="#how-to-use-logging" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to use logging</h3>
<p>With Hydra you can easily use the <a href="https://docs.python.org/3/library/logging.html">logging</a> package provided by Python in your code without any setup. The output of the log is stored in <code class="language-plaintext highlighter-rouge">main.log</code>. Usage example is shown below</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="o">@</span><span class="n">hydra</span><span class="p">.</span><span class="n">main</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="s">"config"</span><span class="p">,</span> <span class="n">config_name</span><span class="o">=</span><span class="s">"config"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">main_func</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
    <span class="n">log</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">"Debug level message"</span><span class="p">)</span>
    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Info level message"</span><span class="p">)</span>
    <span class="n">log</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="s">"Warning level message"</span><span class="p">)</span>
</code></pre></div></div>

<p>The log of <code class="language-plaintext highlighter-rouge">python main.py</code> in this case would be (in <code class="language-plaintext highlighter-rouge">main.log</code>)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[2021-03-13 17:36:06,493][__main__][INFO] - Info level message
[2021-03-13 17:36:06,493][__main__][WARNING] - Warning level message
</code></pre></div></div>

<p>If you want to include <code class="language-plaintext highlighter-rouge">DEBUG</code> also, then override <code class="language-plaintext highlighter-rouge">hydra.verbose=true</code> or <code class="language-plaintext highlighter-rouge">hydra.verbose=__main__</code> (i.e. <code class="language-plaintext highlighter-rouge">python main.py hydra.version=true</code>). The output in <code class="language-plaintext highlighter-rouge">main.log</code> in this case would be</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[2021-03-13 17:36:38,425][__main__][DEBUG] - Debug level message
[2021-03-13 17:36:38,425][__main__][INFO] - Info level message
[2021-03-13 17:36:38,425][__main__][WARNING] - Warning level message
</code></pre></div></div>

<h2 id="quick-omegaconf-overview">
<a class="anchor" href="#quick-omegaconf-overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Quick OmegaConf overview</h2>
<p><a href="https://omegaconf.readthedocs.io/en/latest/index.html">OmegaCong</a> is a YAML based hierarchical configuration system, with support for merging configurations from multiple sources (files, CLI argument, environment variables). You just need to know YAML to use Hydra. OmegaConf is used by Hydra in the background to handle everything for you.</p>

<p>The main things you need to know are shown in the config file below</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">ip</span><span class="pi">:</span> <span class="s2">"</span><span class="s">127.0.0.1"</span>
  <span class="na">port</span><span class="pi">:</span> <span class="s">???</span>       <span class="c1"># Missing value. Must be provided at command line</span>
  <span class="na">address</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${server.ip}:${server.port}"</span> <span class="c1"># String interpolation</span>
</code></pre></div></div>

<p>Now in <code class="language-plaintext highlighter-rouge">main.py</code> you can access the server address as follows</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">hydra</span><span class="p">.</span><span class="n">main</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="s">"config"</span><span class="p">,</span> <span class="n">config_name</span><span class="o">=</span><span class="s">"config"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">main_func</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
    <span class="n">server_address</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="n">server</span><span class="p">.</span><span class="n">address</span>
    <span class="k">print</span><span class="p">(</span><span class="s">f"The server address = </span><span class="si">{</span><span class="n">server_address</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


<span class="c1"># python main.py server.port=10
# The server address = 127.0.0.1:10
</span></code></pre></div></div>

<p>As you can guess from the above example, if you want some variable to take the same value as another variable you should use the following syntax <code class="language-plaintext highlighter-rouge">address:${server.ip}</code>. We will later see some interesting use cases of this.</p>

<h2 id="using-hydra-for-ml-projects">
<a class="anchor" href="#using-hydra-for-ml-projects" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using Hydra for ML projects</h2>
<p>Now you know the basic working’s of hydra, we can focus on using Hydra to develop a machine learning project. Check the hydra <a href="https://hydra.cc/docs/intro">documentation</a> after this post for some of the things not discussed here. And I do not discuss <em><a href="https://hydra.cc/docs/tutorials/structured_config/intro">Structured Configs</a></em> (alternate to yaml files) in this post as you can get everything done without them also.</p>

<p>Recall, the <code class="language-plaintext highlighter-rouge">src</code> directory of our project has the following structure</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src
├── config
│   └── config.yaml
└── main.py
</code></pre></div></div>

<p>We have a separate folder to store all our config files (<code class="language-plaintext highlighter-rouge">config</code>) and the source code of our project is <code class="language-plaintext highlighter-rouge">main.py</code>. Now let’s get started.</p>

<h3 id="dataset">
<a class="anchor" href="#dataset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dataset</h3>
<p>Every ML project begins by collecting data and creating a dataset. When working on an image classification project, we use many different datasets like ImageNet, CIFAR10, and more. And each of these datasets will have different hyperparameters associated with them like batch size, the size of input images, the number of classes, the number of layers of the model to use for a particular dataset and many more.</p>

<p>Instead of using a particular dataset, I use a random dataset as it would make the things general and you can apply the things discussed here on your own datasets. Also, let’s not worry about creating dataloaders, as they are the same thing.</p>

<p>Before discussing the details, let me show you the code and you can easily guess what is happening. The 4 files involved in this example are</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">src/main.py</code></li>
  <li><code class="language-plaintext highlighter-rouge">src/config/config.yaml</code></li>
  <li><code class="language-plaintext highlighter-rouge">src/config/dataset/dataset1.yaml</code></li>
  <li><code class="language-plaintext highlighter-rouge">src/config/dataset/dataset2.yaml</code></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### src/main.py ###
</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">hydra</span>
<span class="kn">from</span> <span class="nn">omegaconf</span> <span class="kn">import</span> <span class="n">DictConfig</span>

<span class="o">@</span><span class="n">hydra</span><span class="p">.</span><span class="n">main</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="s">"config"</span><span class="p">,</span> <span class="n">config_name</span><span class="o">=</span><span class="s">"config.yaml"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_dataset</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
    <span class="n">name_of_dataset</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="n">dataset</span><span class="p">.</span><span class="n">name</span>
    <span class="n">num_samples</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="n">num_samples</span>
    
    <span class="k">if</span> <span class="n">name_of_dataset</span> <span class="o">==</span> <span class="s">"dataset1"</span><span class="p">:</span>
        <span class="n">feature_size</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="n">dataset</span><span class="p">.</span><span class="n">feature_size</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">randn</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">elif</span> <span class="n">name_of_dataset</span> <span class="o">==</span> <span class="s">"dataset2"</span><span class="p">:</span>
        <span class="n">dim1</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="n">dataset</span><span class="p">.</span><span class="n">dim1</span>
        <span class="n">dim2</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="n">dataset</span><span class="p">.</span><span class="n">dim2</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">randn</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"You outplayed the developer"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">get_dataset</span><span class="p">()</span>
</code></pre></div></div>

<p>And the corresponding config files are,</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### src/config/config.yaml</span>
<span class="na">defaults</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">dataset</span><span class="pi">:</span> <span class="s">dataset1</span>

<span class="na">num_samples</span><span class="pi">:</span> <span class="m">2</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### src/config/dataset/dataset1.yaml</span>

<span class="c1"># @package _group_</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">dataset1</span>
<span class="na">feature_size</span><span class="pi">:</span> <span class="m">5</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### src/config/dataset/dataset1.yaml</span>

<span class="c1"># @package _group_</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">dataset2</span>
<span class="na">dim1</span><span class="pi">:</span> <span class="m">10</span>
<span class="na">dim2</span><span class="pi">:</span> <span class="m">20</span>
</code></pre></div></div>

<p>To be honest this is pretty much everything you need to use hydra in your projects. Let us see what is actually happening in the above code</p>
<ul>
  <li>In <code class="language-plaintext highlighter-rouge">src/main.py</code>, you will see that there are some common variables, namely <code class="language-plaintext highlighter-rouge">cfg.dataset</code> and <code class="language-plaintext highlighter-rouge">cfg.num_samples</code> that are shared across all the datasets. These are defined in our main config file that we pass to hydra using the command <code class="language-plaintext highlighter-rouge">@hydra.main(...)</code>.</li>
  <li>
    <p>Next, we need to define some variables specific to every dataset (like number of classes in ImageNet and CIFAR10). To achieve this in hydra, we use the following syntax</p>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="na">defaults</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">dataset</span><span class="pi">:</span> <span class="s">dataset1</span>
</code></pre></div>    </div>

    <p>Here <code class="language-plaintext highlighter-rouge">dataset</code> is the name of the folder that will contain all the corresponding <em>yaml</em> files for each dataset (i.e. <code class="language-plaintext highlighter-rouge">dataset1</code> and <code class="language-plaintext highlighter-rouge">dataset2</code> in our case). So the directory structure would look something like this</p>
    <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  config
  ├── config.yaml
  └── dataset
      ├── dataset1.yaml
      └── dataset2.yaml
</code></pre></div>    </div>

    <p>And that is it. Now you can define the variables specific to your every dataset in each of the above files, independent of each other.</p>
  </li>
  <li>These are called <a href="https://hydra.cc/docs/tutorials/basic/your_first_app/config_groups">config groups</a>. Every config file is independent of other config files in the folder and we can only choose one of the config files. To define these config groups you need to include a special comment at the beginning of every file <code class="language-plaintext highlighter-rouge"># @package _group_</code>.</li>
</ul>

<blockquote>
  <p>We can only choose one config file out of <code class="language-plaintext highlighter-rouge">dataset1.yaml</code> and <code class="language-plaintext highlighter-rouge">dataset2.yaml</code> as the value of <code class="language-plaintext highlighter-rouge">dataset</code>. And to tell hydra that these are config groups, we need to include the special comment <code class="language-plaintext highlighter-rouge"># @package _group_</code> at the start of these files.</p>
</blockquote>

<blockquote>
  <p><strong>Note</strong>: In Hydra 1.1, <code class="language-plaintext highlighter-rouge">_group_</code> will become the default <code class="language-plaintext highlighter-rouge">package</code> and there will be no need to add the special comment.</p>
</blockquote>

<ul>
  <li>What is <strong>defaults</strong>? In our main config file we need some way to distinguish normal string values from config group values. Like in this case, we want <code class="language-plaintext highlighter-rouge">dataset: dataset1</code> to be interpreted as a config group value rather than a string value. To do this we define all the config groups in <code class="language-plaintext highlighter-rouge">defaults</code>. And as you guessed it you provide a default value to it.
    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="na">defaults</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">dataset</span><span class="pi">:</span> <span class="s">dataset1</span> <span class="c1"># By default use `dataset/dataset1.yaml</span>

  <span class="c1">## OR</span>

  <span class="na">defaults</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">dataset</span><span class="pi">:</span> <span class="s">???</span>  <span class="c1"># Must be specified at command line</span>
</code></pre></div>    </div>
  </li>
</ul>

<blockquote>
  <p><strong>Note</strong>: <code class="language-plaintext highlighter-rouge">defaults</code> takes a list as input, so you need to start every name with a <code class="language-plaintext highlighter-rouge">-</code>.</p>
</blockquote>

<p>We can check the output for the above code.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; python dataset.py
torch.Size([2, 5])
</code></pre></div></div>
<p>and</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; python dataset.py dataset=dataset2
torch.Size([2, 10, 20])
</code></pre></div></div>

<p>Now pause and think for a second. You can use this same technique to define hyperparameter values for all your optimizers. Just create a new folder called <code class="language-plaintext highlighter-rouge">optimizer</code> and write <code class="language-plaintext highlighter-rouge">sgd.yaml</code>, <code class="language-plaintext highlighter-rouge">adam.yaml</code> files. And in the main <code class="language-plaintext highlighter-rouge">config.yaml</code>, you only need to add one more line</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">defaults</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">dataset</span><span class="pi">:</span> <span class="s">dataset1</span>
  <span class="pi">-</span> <span class="na">optimizer</span><span class="pi">:</span> <span class="s">adam</span>
</code></pre></div></div>
<p>and you use this to also create config files for learning rate schedulers, models, evaluation metrics and almost everything else without having to actually hard code any of these values in the main codebase. You no longer need to remember which learning rate you used to run that model, as a backup of the config file used to run the python script is always stored in the folder created by hydra.</p>

<h3 id="model">
<a class="anchor" href="#model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Model</h3>
<p>There is one special case that you also need to know. What if you want your ResNet model to have different number of layers when using ImageNet vs CIFAR10. The naive solution would be to add <code class="language-plaintext highlighter-rouge">if-else</code> conditions in your model definition for every dataset, but that is a bad choice. What if tomorrow you add a new dataset. Now you would have to modify your model <code class="language-plaintext highlighter-rouge">if-else</code> condition to handle this new dataset. So instead we define a value <code class="language-plaintext highlighter-rouge">num_layers</code> in the config file and then we can use this value to create how every many layers we want.</p>

<p>Suppose we use two models, resnet and vgg. Based on the discussion in previous topic, we would have a separate config file for each model. The directory structure of the <code class="language-plaintext highlighter-rouge">config</code> folder would be</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>config
├── config.yaml
├── dataset
│   ├── cifar10.yaml
│   └── imagenet.yaml
└── model
    ├── resnet.yaml
    └── vgg.yaml
</code></pre></div></div>

<p>Now suppose we want the resnet model to have 34 layers when using CIFAR10 and 50 layers for every other dataset. In this case the <code class="language-plaintext highlighter-rouge">config/model/resnet.yaml</code> file would be</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># @package _group_</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">resnet</span>
<span class="na">num_layers</span><span class="pi">:</span> <span class="m">50</span> <span class="c1"># As 50 is the default value</span>
</code></pre></div></div>

<p>Now we want to set the value <code class="language-plaintext highlighter-rouge">num_layers=34</code> when the user specifies CIFAR10 dataset. To do this we can define a new config group in which we can define all the combinations of the special cases. In the main <code class="language-plaintext highlighter-rouge">config/config.yaml</code> we would make the following changes</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">defaults</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">dataset</span><span class="pi">:</span> <span class="s">imagenet</span>
  <span class="pi">-</span> <span class="na">model</span><span class="pi">:</span> <span class="s">resnet</span>
  <span class="pi">-</span> <span class="na">dataset_model</span><span class="pi">:</span> <span class="s">${defaults.0.dataset}_${defaults.1.model}</span>
    <span class="na">optional</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p>Here we created a new config group named <code class="language-plaintext highlighter-rouge">dataset_model</code> that takes the value specified by <code class="language-plaintext highlighter-rouge">dataset</code> and <code class="language-plaintext highlighter-rouge">model</code> (like <code class="language-plaintext highlighter-rouge">imagenet_resnet</code>, <code class="language-plaintext highlighter-rouge">cifar10_resnet</code>). This is some weird syntax as <code class="language-plaintext highlighter-rouge">defaults</code> is a list, so you need to specify index before the name i.e. <code class="language-plaintext highlighter-rouge">defaults.0.dataset</code>. Now we can define the config file in <code class="language-plaintext highlighter-rouge">dataset_model/cifar10_resnet.yaml</code></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># @package _global_</span>
<span class="na">model</span><span class="pi">:</span>
  <span class="na">num_layers</span><span class="pi">:</span> <span class="m">5</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: Here we used <code class="language-plaintext highlighter-rouge"># @package _global_</code> instead of <code class="language-plaintext highlighter-rouge"># @package _group_</code>.</p>
</blockquote>

<p>We can test the code as follows, where we simply print out the number of features returned by the config file</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">hydra</span><span class="p">.</span><span class="n">main</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="s">"config"</span><span class="p">,</span> <span class="n">config_name</span><span class="o">=</span><span class="s">"config"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">main_func</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">f"Num features = </span><span class="si">{</span><span class="n">cfg</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">num_layers</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; python main.py dataset=imagenet
Num features = 50

&gt; python main.py dataset=cifar10
Num features = 34
</code></pre></div></div>

<p>We have to specify <code class="language-plaintext highlighter-rouge">optional: true</code>, as without it we would need to specify all combinations of <code class="language-plaintext highlighter-rouge">dataset</code> and <code class="language-plaintext highlighter-rouge">model</code> (if a user enters a value of <code class="language-plaintext highlighter-rouge">dataset</code> and <code class="language-plaintext highlighter-rouge">model</code> such that we have no config file for that option, then Hydra will throw an error for missing config file).</p>

<p><a href="https://hydra.cc/docs/patterns/specializing_config">documentation</a> of this topic.</p>

<p>The rest of the process is same, create separate config groups for optimizer, learning rate scheduler, callbacks, evaluation metrics, losses, training scripts. In terms of creating config files and using them in your project this is all you need to know.</p>

<h2 id="random-things">
<a class="anchor" href="#random-things" aria-hidden="true"><span class="octicon octicon-link"></span></a>Random things</h2>

<h3 id="show-config-file">
<a class="anchor" href="#show-config-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>Show config file</h3>
<p>Prints the config file that is being passed to a function without running the function. Usage <code class="language-plaintext highlighter-rouge">--cfg [OPTION]</code> Valid <code class="language-plaintext highlighter-rouge">OPTION</code> are</p>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">job</code>: Your config file</li>
  <li>
<code class="language-plaintext highlighter-rouge">hydra</code>: Hydra’s config</li>
  <li>
<code class="language-plaintext highlighter-rouge">all</code> : <code class="language-plaintext highlighter-rouge">job</code> + <code class="language-plaintext highlighter-rouge">hydra</code>
</li>
</ul>

<p>This is useful for quick debugging when you want to check what is being passed to a function. Example,</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; python main.py --cfg job
# @package _global_
num_samples: 2
dataset:
  name: dataset1
  feature_size: 5
</code></pre></div></div>
<h3 id="multi-run">
<a class="anchor" href="#multi-run" aria-hidden="true"><span class="octicon octicon-link"></span></a>Multi-run</h3>
<p>This is a very useful feature of hydra. Check the <a href="https://hydra.cc/docs/tutorials/basic/running_your_app/multi-run">docs</a> for more details. The main idea is you can run your model for different values of learning rate, different values of weight decay using a single command. An example is shown below</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">❯</span> <span class="n">python</span> <span class="n">main</span><span class="p">.</span><span class="n">py</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span><span class="mf">1e-2</span> <span class="n">wd</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span><span class="mf">1e-2</span> <span class="o">-</span><span class="n">m</span>
<span class="p">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">15</span> <span class="mi">04</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">57</span><span class="p">,</span><span class="mi">882</span><span class="p">][</span><span class="n">HYDRA</span><span class="p">]</span> <span class="n">Launching</span> <span class="mi">4</span> <span class="n">jobs</span> <span class="n">locally</span>
<span class="p">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">15</span> <span class="mi">04</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">57</span><span class="p">,</span><span class="mi">882</span><span class="p">][</span><span class="n">HYDRA</span><span class="p">]</span>        <span class="c1">#0 : lr=0.001 wd=0.0001
</span><span class="p">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">15</span> <span class="mi">04</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">58</span><span class="p">,</span><span class="mi">016</span><span class="p">][</span><span class="n">HYDRA</span><span class="p">]</span>        <span class="c1">#1 : lr=0.001 wd=0.01
</span><span class="p">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">15</span> <span class="mi">04</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">58</span><span class="p">,</span><span class="mi">149</span><span class="p">][</span><span class="n">HYDRA</span><span class="p">]</span>        <span class="c1">#2 : lr=0.01 wd=0.0001
</span><span class="p">[</span><span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">15</span> <span class="mi">04</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">58</span><span class="p">,</span><span class="mi">275</span><span class="p">][</span><span class="n">HYDRA</span><span class="p">]</span>        <span class="c1">#3 : lr=0.01 wd=0.01
</span></code></pre></div></div>

<p>Hydra will run your script with all combinations of <code class="language-plaintext highlighter-rouge">lr</code> and <code class="language-plaintext highlighter-rouge">wd</code>. The output will be stored in a new folder called <code class="language-plaintext highlighter-rouge">multirun</code> (instead of <code class="language-plaintext highlighter-rouge">outputs</code>). This folder also follows the same syntax of storing the contents in a date and time subfolder. The directory structure after running the above command is shown below</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>multirun
└── 2021-03-15
    └── 04-21-32
        ├── 0
        │   ├── .hydra
        │   └── main.log
        ├── 1
        │   ├── .hydra
        │   └── main.log
        ├── 2
        │   ├── .hydra
        │   └── main.log
        ├── 3
        │   ├── .hydra
        │   └── main.log
        └── multirun.yaml
</code></pre></div></div>

<p>It is same as <code class="language-plaintext highlighter-rouge">outputs</code> except four folders are created here for the run instead of one. You can check the <a href="https://hydra.cc/docs/tutorials/basic/running_your_app/multi-run">documentation</a> on different ways of specifying the value of the variables to run the script on (these are called <em>sweeps</em>).</p>

<p>Also, this would run your script locally and sequentially. If you want to run your script in parallel across multiple nodes or run it on AWS, you can check the documentation for the following plugins</p>
<ul>
  <li>
<a href="https://hydra.cc/docs/plugins/joblib_launcher">Joblib</a> - Uses <a href="https://joblib.readthedocs.io/en/latest/parallel.html">Joblib.Parallel</a>
</li>
  <li>
<a href="https://hydra.cc/docs/plugins/ray_launcher">Ray</a> - Run jobs on aws cluster or local cluster</li>
  <li><a href="https://hydra.cc/docs/plugins/rq_launcher">RQ</a></li>
  <li><a href="https://hydra.cc/docs/plugins/submitit_launcher">Submitit</a></li>
</ul>

<h3 id="add-color-to-terminal">
<a class="anchor" href="#add-color-to-terminal" aria-hidden="true"><span class="octicon octicon-link"></span></a>Add color to terminal</h3>
<p>You can add color to the output of terminal output of Hydra by installing this plugin</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pip</span> <span class="n">install</span> <span class="n">hydra_colorlog</span> <span class="o">--</span><span class="n">upgrade</span>
</code></pre></div></div>
<p>and then changing these defaults in your config file</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">defaults</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">hydra/job_logging</span><span class="pi">:</span> <span class="s">colorlog</span>
  <span class="pi">-</span> <span class="s">hydra/hydra_logging</span><span class="pi">:</span> <span class="s">colorlog</span>
</code></pre></div></div>

<h3 id="specify-help-message">
<a class="anchor" href="#specify-help-message" aria-hidden="true"><span class="octicon octicon-link"></span></a>Specify help message</h3>
<p>You can check the logs of one of your runs (under <code class="language-plaintext highlighter-rouge">.hydra/hydra.yaml</code> and then going to <code class="language-plaintext highlighter-rouge">help.template</code>) to see the default help message printed by hydra. But you can modify that message in your main config file as follows</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### config.yaml</span>

<span class="na">hydra</span><span class="pi">:</span>
  <span class="na">help</span><span class="pi">:</span>
    <span class="na">template</span><span class="pi">:</span>
      <span class="s1">'</span><span class="s">This</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">help</span><span class="nv"> </span><span class="s">message'</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; python main.py --help
This is the help message
</code></pre></div></div>

<h3 id="output-directory-name">
<a class="anchor" href="#output-directory-name" aria-hidden="true"><span class="octicon octicon-link"></span></a>Output directory name</h3>
<p>If you want something more specific, than the <strong>DATE/TIME</strong> naming scheme using by hydra to store the output of all your runs, you can specify the folder name at command line</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python main.py hydra.run.dir=outputs/my_run

OR

python main.py lr=1e-2,1e-3 hydra.sweep.dir=multirun/my_run -m  
</code></pre></div></div>
<hr>

<p>That would be it for today. Hope this helps you in using Hydra in your projects.</p>

<p><a href="https://twitter.com/Kkushaj">twitter</a>, <a href="https://www.linkedin.com/in/kushaj/">linkedin</a>, <a href="https://github.com/KushajveerSingh">github</a></p>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="KushajveerSingh/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/complete-tutorial-on-how-to-use-hydra-in-machine-learning-projects" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Software Engineer working in Full Stack Development, Computer Vision, and Graph Machine Learning.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/KushajveerSingh" target="_blank" title="KushajveerSingh"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/Kkushaj" target="_blank" title="Kkushaj"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
